import{r,k as N,o as P,c as Q,w as U,m as v,N as q,b as d,a as t,e as k,q as R,f as w}from"./app-b6edf1e3.js";import{a as b}from"./QSelect-0453cb93.js";import{Q as D}from"./QPage-82bd59c9.js";import{_ as E}from"./RulesTable-a32c21db.js";import"./QTable-c7aadd40.js";import"./QPagination-e6ad8bb7.js";const T={class:"bg-white q-ma-sm q-pa-sm"},z={class:"bg-white shadow-3 q-px-sm rounded-borders q-pb-md"},F={class:"row"},L={class:"q-my-md q-ml-sm col-5 row bg-grey-3 rounded-borders"},M={class:"row q-mt-sm q-ml-sm"},J={__name:"Index",setup(O){const _=r([]),p=r([]),c=r([]),m=r([]),u=r(!1),n=r({page:1,rowsPerPage:20,rowsNumber:0}),l=r({purpose_expression:"",operation_type:null,include_commons:!1}),g=async()=>{var o,e,a,i,f,y,x,V;try{const s=await v.get("/api/rules",{params:{load:["category,contractor"],paginate:n.value.rowsPerPage,page:n.value.page,purpose_expression:l.value.purpose_expression,operation_type:(o=l.value.operation_type)==null?void 0:o.value,include_commons:!!l.value.include_commons,contractor_ids:m.value?m.value.map(I=>I.id):null,category_id:l.value.categories}});n.value.rowsNumber=(a=(e=s.data)==null?void 0:e.meta)==null?void 0:a.total,n.value.page=(f=(i=s.data)==null?void 0:i.meta)==null?void 0:f.current_page,n.value.totalPages=(x=(y=s.data)==null?void 0:y.meta)==null?void 0:x.last_page,_.value=(V=s==null?void 0:s.data)==null?void 0:V.data,console.log(s.data.data)}catch(s){console.log(s),q.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},h=async(o,e,a)=>{if(o.length>3){u.value=!0;try{const i=await v.get("/api/contractors",{params:{q:o}});p.value=i.data.data,e(()=>p.value)}catch(i){console.log(i),a()}finally{u.value=!1}}else p.value=[],e(()=>p.value)},C=async(o,e,a)=>{o.length>3?(u.value=!0,await B(o),e(()=>c.value),u.value=!1):(c.value=[],e(()=>c.value))},B=async(o="")=>{try{const e=await v.get("/api/categories",{params:{q:o||""}});c.value=e.data.data}catch{q.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}};return N(()=>{g()}),(o,e)=>(P(),Q(D,{class:"bg-grey-2"},{default:U(()=>[d("div",T,[d("div",z,[e[6]||(e[6]=d("p",{class:"text-h6 text-center"}," Правила операций ",-1)),d("div",F,[t(k,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:l.value.purpose_expression,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.purpose_expression=a),label:"Регулярное выражение"},null,8,["modelValue"]),t(b,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:l.value.operation_type,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.operation_type=a),label:"Тип операции",options:[{label:"DEBIT",value:"DEBIT"},{label:"CREDIT",value:"CREDIT"}]},null,8,["modelValue"]),t(b,{class:"col-3 q-px-sm",dense:"",outlined:"",filled:"",flat:"",label:"Категория",modelValue:l.value.categories,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.categories=a),options:c.value,"option-label":"name",clearable:"",multiple:"","use-input":"",borderless:"","use-chips":"",onFilter:C,loading:u.value},null,8,["modelValue","options","loading"]),d("div",L,[t(b,{class:"q-px-sm col-8",dense:"",borderless:"",label:"Контрагенты (получатели)",modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=a=>m.value=a),options:p.value,"use-input":"",multiple:"",clearable:"","option-label":"name",onFilter:h,loading:u.value,"use-chips":""},null,8,["modelValue","options","loading"]),t(R,{class:"col-4",modelValue:l.value.include_commons,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.include_commons=a),label:"включая общие"},null,8,["modelValue"])])]),d("div",M,[t(w,{class:"text-right",dense:"",size:"sm",onClick:g,label:"Применить фильтры",color:"primary"}),t(w,{class:"text-right q-ml-sm",dense:"",size:"sm",to:{name:"CreateRule"},label:"Создать правило",color:"primary"})])]),t(E,{rules:_.value,pagination:n.value,"onUpdate:pagination":e[5]||(e[5]=a=>{n.value=a,g()}),onRefresh:g},null,8,["rules","pagination"])])]),_:1}))}};export{J as default};
