import{u as z,r as F,A as S,o as n,s as c,a as d,w as f,F as y,v as b,t as k,l as g,c as B,b as x,n as Q,N as q}from"./app-90a1488f.js";import{a as U,Q as $}from"./QTable-67b938ce.js";import{Q as D}from"./QPagination-893ca371.js";const I={key:0,class:"rounded-borders shadow-3"},M={key:3,class:"row justify-between"},O={class:"row bg-white justify-center q-pb-md"},G={key:1},L={__name:"RulesTable",props:{rules:Array,pagination:Object},emits:["update:pagination","refresh"],setup(r,{emit:A}){z();const R=r,w=A,T=F([{name:"category",label:"Категория",field:t=>{var a;return(a=t==null?void 0:t.category)==null?void 0:a.name},align:"left",sortable:!0,sort:(t,a,o,i)=>{var s,l;const e=((s=o.category)==null?void 0:s.name)||"",u=((l=i.category)==null?void 0:l.name)||"";return e.localeCompare(u)}},{name:"contractor",label:"Контрагент",field:t=>{var a;return(a=t==null?void 0:t.contractor)==null?void 0:a.full_name},align:"left",sortable:!0,sort:(t,a,o,i)=>{var s,l;const e=((s=o.contractor)==null?void 0:s.full_name)||"",u=((l=i.contractor)==null?void 0:l.full_name)||"";return e.localeCompare(u)}},{name:"purpose_expression",label:"Регулярное выражение",field:"purpose_expression",align:"left"},{name:"actions",label:"Действия",align:"left"}]),j=async t=>{var a;try{const o=await axios.delete(`/api/rules/${t}`);(a=o==null?void 0:o.data)!=null&&a.success&&(q.create({message:"Правило успешно удалено",color:"green",timeout:2e3}),w("refresh"))}catch{q.create({message:"Ошибка удаления",color:"red",timeout:2e3})}},E=t=>{w("update:pagination",{...R.pagination,page:t})};return(t,a)=>{var i;const o=S("router-link");return n(),c("div",null,[r.rules.length?(n(),c("div",I,[d($,{class:"q-mt-md q-px-sm",rows:r.rules,pagination:{rowsPerPage:(i=r.pagination)==null?void 0:i.rowsPerPage},columns:T.value,"row-key":"id","hide-bottom":"",flat:""},{"body-cell":f(e=>[d(U,{item:e},{default:f(()=>{var u,s,l,_,h,v,C,P,N,V;return[e.col.name==="purpose_expression"?(n(),c(y,{key:0},[b(k((u=e.row)==null?void 0:u.purpose_expression),1)],64)):g("",!0),e.col.name==="category"?(n(),B(o,{key:1,to:{name:"CategoriesEdit",params:{id:(l=(s=e.row)==null?void 0:s.category)==null?void 0:l.id}},target:"_blank"},{default:f(()=>{var m,p;return[b(k((p=(m=e.row)==null?void 0:m.category)==null?void 0:p.name),1)]}),_:2},1032,["to"])):g("",!0),e.col.name==="contractor"?(n(),c(y,{key:2},[(h=(_=e.row)==null?void 0:_.contractor)!=null&&h.name?g("",!0):(n(),c(y,{key:0},[b(" Для всех ")],64)),(C=(v=e.row)==null?void 0:v.contractor)!=null&&C.full_name?(n(),B(o,{key:1,to:{name:"ContractorShow",params:{id:(N=(P=e.row)==null?void 0:P.contractor)==null?void 0:N.id}},target:"_blank"},{default:f(()=>{var m,p;return[x("div",null,k((p=(m=e.row)==null?void 0:m.contractor)==null?void 0:p.full_name),1)]}),_:2},1032,["to"])):g("",!0)],64)):g("",!0),e.col.name==="actions"?(n(),c("div",M,[d(o,{class:"q-mr-sm",to:{name:"EditRule",params:{id:(V=e==null?void 0:e.row)==null?void 0:V.id}}},{default:f(()=>[d(Q,{name:"edit",size:"xs",class:"cursor-pointer",color:"primary"})]),_:2},1032,["to"]),d(Q,{onClick:m=>j(e.row.id),name:"delete",size:"xs",class:"cursor-pointer",color:"negative"},null,8,["onClick"])])):g("",!0)]}),_:2},1032,["item"])]),_:1},8,["rows","pagination","columns"]),x("div",O,[d(D,{modelValue:r.pagination.page,"onUpdate:modelValue":[a[0]||(a[0]=e=>r.pagination.page=e),E],max:Math.ceil(r.pagination.rowsNumber/r.pagination.rowsPerPage),"boundary-numbers":"","boundary-links":"","max-pages":10,class:"text-center q-mt-md"},null,8,["modelValue","max"])])])):(n(),c("div",G,a[1]||(a[1]=[x("p",{class:"text-h6 text-center"}," Для этого контрагента правила не установлены ",-1)])))])}}};export{L as _};
