import{V as fe,a3 as ge,a4 as E,a5 as ye,a6 as be,C as he,r as f,y as k,a7 as we,a8 as Te,a9 as Ve,aa as ke,ab as xe,j as B,ac as G,ad as K,ae as X,af as Ce,_ as Z,J as Pe,$ as qe,a1 as Se,u as Qe,k as $e,A as Oe,o as Me,c as Ae,w as i,N as S,b as r,a as o,n as D,v as _,S as De,t as ee,f as j,d as P,e as Q,P as te}from"./app-90a1488f.js";import{u as Ue,v as ae,b as Fe,c as Ye,d as Ee,r as oe,s as _e,e as le,p as se,f as je,Q as H}from"./QSelect-7e810c66.js";import{Q as N}from"./QDate-af5d2477.js";import{Q as He}from"./QPage-b67895b6.js";import{O as Ne}from"./OperationTable-a55b570c.js";import"./QTable-67b938ce.js";import"./QPagination-893ca371.js";/* empty css                                                                       */const ne=fe({name:"QTooltip",inheritAttrs:!1,props:{...Ue,...ge,...E,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...E.transitionShow,default:"jump-down"},transitionHide:{...E.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:ae},self:{type:String,default:"top middle",validator:ae},offset:{type:Array,default:()=>[14,14],validator:Fe},scrollTarget:ye,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...be],setup(l,{slots:I,emit:w,attrs:x}){let b,g;const m=he(),{proxy:{$q:u}}=m,v=f(null),p=f(!1),a=k(()=>se(l.anchor,u.lang.rtl)),C=k(()=>se(l.self,u.lang.rtl)),U=k(()=>l.persistent!==!0),{registerTick:$,removeTick:O}=we(),{registerTimeout:T}=Te(),{transitionProps:M,transitionStyle:s}=Ve(l),{localScrollTarget:e,changeScrollEvent:c,unconfigureScrollTarget:t}=Ye(l,W),{anchorEl:n,canShow:A,anchorEvents:h}=Ee({showing:p,configureAnchorEl:ce}),{show:y,hide:F}=ke({showing:p,canShow:A,handleShow:ue,handleHide:ie,hideOnRouteChange:U,processOnMount:!0});Object.assign(h,{delayShow:de,delayHide:me});const{showPortal:z,hidePortal:L,renderPortal:re}=xe(m,v,pe,"tooltip");if(u.platform.is.mobile===!0){const d={anchorEl:n,innerRef:v,onClickOutside(V){return F(V),V.target.classList.contains("q-dialog__backdrop")&&Se(V),!0}},Y=k(()=>l.modelValue===null&&l.persistent!==!0&&p.value===!0);B(Y,V=>{(V===!0?je:oe)(d)}),G(()=>{oe(d)})}function ue(d){z(),$(()=>{g=new MutationObserver(()=>q()),g.observe(v.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),q(),W()}),b===void 0&&(b=B(()=>u.screen.width+"|"+u.screen.height+"|"+l.self+"|"+l.anchor+"|"+u.lang.rtl,q)),T(()=>{z(!0),w("show",d)},l.transitionDuration)}function ie(d){O(),L(),R(),T(()=>{L(!0),w("hide",d)},l.transitionDuration)}function R(){g!==void 0&&(g.disconnect(),g=void 0),b!==void 0&&(b(),b=void 0),t(),K(h,"tooltipTemp")}function q(){_e({targetEl:v.value,offset:l.offset,anchorEl:n.value,anchorOrigin:a.value,selfOrigin:C.value,maxHeight:l.maxHeight,maxWidth:l.maxWidth})}function de(d){if(u.platform.is.mobile===!0){le(),document.body.classList.add("non-selectable");const Y=n.value,V=["touchmove","touchcancel","touchend","click"].map(J=>[Y,J,"delayHide","passiveCapture"]);X(h,"tooltipTemp",V)}T(()=>{y(d)},l.delay)}function me(d){u.platform.is.mobile===!0&&(K(h,"tooltipTemp"),le(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),T(()=>{F(d)},l.hideDelay)}function ce(){if(l.noParentEvent===!0||n.value===null)return;const d=u.platform.is.mobile===!0?[[n.value,"touchstart","delayShow","passive"]]:[[n.value,"mouseenter","delayShow","passive"],[n.value,"mouseleave","delayHide","passive"]];X(h,"anchor",d)}function W(){if(n.value!==null||l.scrollTarget!==void 0){e.value=Ce(n.value,l.scrollTarget);const d=l.noParentEvent===!0?q:F;c(e.value,d)}}function ve(){return p.value===!0?Z("div",{...x,ref:v,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",x.class],style:[x.style,s.value],role:"tooltip"},qe(I.default)):null}function pe(){return Z(Pe,M.value,ve)}return G(R),Object.assign(m.proxy,{updatePosition:q}),re}}),Be={class:"row justify-center"},Ie={class:"row justify-center col-12 q-px-md q-pt-lg q-mb-sm"},ze={class:"text-blue-5 row full-width"},Le=["onClick"],Re={class:"col-12 bg-white shadow-24 q-pa-md rounded-borders q-mb-md"},We={class:"row"},Je={class:"col-12 text-h6"},Ge={class:"col-12 text-h6"},Ke={class:"col-12 bg-grey-3 q-px-sm"},Xe={class:"bg-white shadow-3 q-px-sm rounded-borders q-pb-md"},Ze={class:"row"},et={class:"row q-mt-sm"},tt={class:"row justify-end q-mt-sm q-ml-sm"},dt={__name:"Operations",setup(l){const w=Qe().params.id,x=f([]),b=f(!1),g=f({}),m=f({page:1,rowsPerPage:20,rowsNumber:0}),u=f(!1),v=f(!1),p=f(!1),a=f({purposeQuery:"",categoryQuery:"",dateAt:null,dateFrom:null,dateTo:null,payeeContractorIds:[]});B(a,()=>{m.value.page=1},{deep:!0});const C=async()=>{var s,e,c,t,n,A,h;try{const y=await axios.get("/api/operations",{params:{payeeContractorId:w,paginate:m.value.rowsPerPage,page:m.value.page,dateAt:a.value.dateAt,dateTo:a.value.dateTo,dateFrom:a.value.dateFrom,purposeQuery:a.value.purposeQuery,categoryQuery:a.value.categoryQuery}});x.value=(s=y==null?void 0:y.data)==null?void 0:s.data,m.value.rowsNumber=(c=(e=y.data)==null?void 0:e.meta)==null?void 0:c.total,m.value.page=(n=(t=y.data)==null?void 0:t.meta)==null?void 0:n.current_page,m.value.totalPages=(h=(A=y.data)==null?void 0:A.meta)==null?void 0:h.last_page}catch{S.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},U=async()=>{try{const s=await axios.get("/api/contractors/"+w);g.value=s.data.data}catch{S.create({message:"Ошибка получения данных",color:"red",timeout:2e3})}},$=async()=>{te.show(),b.value=!0;try{const s=await axios.get(`/api/contractors/${w}/check`);s.data.success?S.create({message:s.data.message,color:"green",timeout:2e3}):S.create({message:"Ошибка проверки",color:"red",timeout:2e3})}catch{S.create({message:"Ошибка проверки",color:"red",timeout:2e3})}b.value=!1,te.hide()},O=k(()=>{var s,e;if((s=a==null?void 0:a.value)!=null&&s.dateAt){let[c,t,n]=(e=a.value.dateAt)==null?void 0:e.split("-");return`${n}.${t}.${c}`}return""}),T=k(()=>{var s,e;if((s=a==null?void 0:a.value)!=null&&s.dateFrom){let[c,t,n]=(e=a.value.dateFrom)==null?void 0:e.split("-");return`${n}.${t}.${c}`}return""}),M=k(()=>{var s,e;if((s=a==null?void 0:a.value)!=null&&s.dateTo){let[c,t,n]=(e=a.value.dateTo)==null?void 0:e.split("-");return`${n}.${t}.${c}`}return""});return $e(()=>{U(),C()}),(s,e)=>{const c=Oe("router-link");return Me(),Ae(He,{class:"bg-grey-3"},{default:i(()=>[r("div",Be,[r("div",Ie,[r("p",ze,[o(c,{to:{name:"ContractorShow",params:{id:De(w)}},custom:""},{default:i(({navigate:t})=>[r("div",{onClick:t,class:"cursor-pointer"},[o(D,{size:"sm",name:"keyboard_arrow_left"}),e[21]||(e[21]=_(" Назад "))],8,Le)]),_:1},8,["to"])]),r("div",Re,[e[24]||(e[24]=r("div",{class:"row justify-center"},[r("span",{class:"text-h6"}," Информация о контрагенте ")],-1)),r("div",We,[r("div",Je," Имя контрагента: "+ee(g.value.full_name),1),r("div",Ge," ИНН контрагента: "+ee(g.value.inn_kpp),1),r("div",null,[o(j,{class:"q-my-sm q-mr-sm q-px-sm",dense:"","no-caps":"",size:"md",label:"Проверить",icon:"assignment_turned_in",onClick:$,color:"primary"},{default:i(()=>[o(ne,null,{default:i(()=>e[22]||(e[22]=[_(" Проверить операции контрагента ")])),_:1})]),_:1}),o(j,{class:"q-my-sm q-px-md",dense:"","no-caps":"",size:"md",label:"Создать",icon:"add_circle_outline",onClick:$,color:"primary"},{default:i(()=>[o(ne,null,{default:i(()=>e[23]||(e[23]=[_(" Создать новую операцию ")])),_:1})]),_:1})])])]),r("div",Ke,[r("div",Xe,[e[25]||(e[25]=r("p",{class:"text-h6 text-center"}," Операции контрагента ",-1)),r("div",Ze,[o(Q,{class:"col-2 q-px-sm",dense:"",outlined:"",filled:"",modelValue:O.value,"onUpdate:modelValue":e[4]||(e[4]=t=>O.value=t),label:"Дата",readonly:"",onClick:e[5]||(e[5]=P(t=>u.value=!0,["stop"]))},{append:i(()=>[o(D,{name:"event",onClick:e[0]||(e[0]=P(t=>u.value=!0,["stop"]))})]),default:i(()=>[o(H,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value=t),anchor:"bottom left",self:"top left"},{default:i(()=>[o(N,{modelValue:a.value.dateAt,"onUpdate:modelValue":[e[1]||(e[1]=t=>a.value.dateAt=t),e[2]||(e[2]=t=>u.value=!1)],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),o(Q,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:a.value.categoryQuery,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.categoryQuery=t),label:"Категории"},null,8,["modelValue"]),o(Q,{class:"col-3 q-px-sm",clearable:"",dense:"",outlined:"",filled:"",modelValue:a.value.purposeQuery,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.purposeQuery=t),label:"Назначение"},null,8,["modelValue"])]),r("div",et,[o(Q,{class:"col-2 q-px-sm",dense:"",outlined:"",filled:"",modelValue:T.value,"onUpdate:modelValue":e[12]||(e[12]=t=>T.value=t),label:"Дата начала",readonly:"",onClick:e[13]||(e[13]=P(t=>v.value=!0,["stop"]))},{append:i(()=>[o(D,{name:"event",onClick:e[8]||(e[8]=P(t=>v.value=!0,["stop"]))})]),default:i(()=>[o(H,{modelValue:v.value,"onUpdate:modelValue":e[11]||(e[11]=t=>v.value=t),anchor:"bottom left",self:"top left"},{default:i(()=>[o(N,{modelValue:a.value.dateFrom,"onUpdate:modelValue":[e[9]||(e[9]=t=>a.value.dateFrom=t),e[10]||(e[10]=t=>v.value=!1)],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),o(Q,{class:"col-2 q-px-sm",dense:"",outlined:"",filled:"",modelValue:M.value,"onUpdate:modelValue":e[18]||(e[18]=t=>M.value=t),label:"Дата конца",readonly:"",onClick:e[19]||(e[19]=P(t=>p.value=!0,["stop"]))},{append:i(()=>[o(D,{name:"event",onClick:e[14]||(e[14]=P(t=>p.value=!0,["stop"]))})]),default:i(()=>[o(H,{modelValue:p.value,"onUpdate:modelValue":e[17]||(e[17]=t=>p.value=t),anchor:"bottom left",self:"top left"},{default:i(()=>[o(N,{modelValue:a.value.dateTo,"onUpdate:modelValue":[e[15]||(e[15]=t=>a.value.dateTo=t),e[16]||(e[16]=t=>p.value=!1)],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),r("div",tt,[o(j,{class:"text-right",dense:"",size:"sm",onClick:C,label:"Применить фильтры",color:"green"})])]),o(Ne,{operations:x.value,pagination:m.value,"onUpdate:pagination":e[20]||(e[20]=t=>{m.value=t,C()}),onRefresh:C},null,8,["operations","pagination"])])])])]),_:1})}}};export{dt as default};
